<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="8 Common Questions #  8.1 ヘッダーファイルはどこで入手できますか？ #  もし、あなたのシステムに既にないのであれば、おそらく必要ないでしょう。あなたのプラットフォームのマニュアルを参照してください。Windows 用にビルドする場合は、#include <winsock.h> だけが必要です。
8.2 bind() が &ldquo;Address already in use&rdquo; と報告した場合、どうすればよいのでしょうか？ #  リスニングしているソケットで SO_REUSEADDR オプションを指定して setsockopt() を使用する必要があります。例として、 bind() の章と select() の章をチェックしてみてください。
8.3 システム上のオープンソケットのリストを取得するにはどうすればよいですか？ #  netstat を使用します。詳しくは man ページをチェックしてください。しかし、タイプするだけで良い出力が得られるはずです。
$ netstat 唯一のコツは、どのソケットがどのプログラムに関連付けられているかを判断することです。:-)
8.4 ルーティングテーブルを見るにはどうしたらいいですか？ #  route コマンド（ほとんどの Linux では /sbin にあります）または netstat -r コマンドを実行します。
8.5 クライアントとサーバのプログラムが1台しかない場合、どのように実行すればよいのでしょうか？ネットワークプログラムを書くのにネットワークは必要ないのですか？ #  幸いなことに、事実上すべてのマシンは、カーネル内に配置され、ネットワークカードのふりをするループバックネットワーク&#34;デバイス&#34;を実装しています。（これはルーティングテーブルで &ldquo;lo&rdquo; としてリストされるインターフェースです。）
あなたが &ldquo;goat&rdquo; という名前のマシンにログインしていると仮定します。あるウィンドウでクライアントを、別のウィンドウでサーバを実行します。あるいは、サーバをバックグラウンドで起動し（&#34;server &&#34;）、同じウィンドウでクライアントを実行します。ループバックデバイスの利点は、client goat か client localhost（localhost は /etc/hosts ファイルで定義されていると思われるので）を使えば、ネットワークなしでクライアントがサーバと通信できるようになることです！">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="8 Common Questions">
<meta property="og:description" content>
<meta property="og:type" content="website">
<meta property="og:url" content="https://solareenlo.com/bgnet/docs/common-questions/">
<title>8 Common Questions | Beej's Guide to Network Programming</title>
<link rel=manifest href=/bgnet/manifest.json>
<link rel=icon href=/bgnet/favicon.png type=image/x-icon>
<link rel=stylesheet href=/bgnet/book.min.3fc729a37471ee87e40517478b6ab5936d22fcb6008d40985724e4295d1a74c0.css integrity="sha256-P8cpo3Rx7ofkBRdHi2q1k20i/LYAjUCYVyTkKV0adMA=" crossorigin=anonymous>
<script defer src=/bgnet/flexsearch.min.js></script>
<script defer src=/bgnet/en.search.min.96186359677d3260e56b54ad32896768914aa874b07c8dc22b598beaa926b613.js integrity="sha256-lhhjWWd9MmDla1StMolnaJFKqHSwfI3CK1mL6qkmthM=" crossorigin=anonymous></script>
<link rel=alternate type=application/rss+xml href=https://solareenlo.com/bgnet/docs/common-questions/index.xml title="Beej's Guide to Network Programming">
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/bgnet/><span>Beej's Guide to Network Programming</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<a href=/bgnet/docs/intro><strong>1</strong> Intro</a>
<ul>
<li>
<a href=/bgnet/docs/intro/#11-audience><strong>1.1</strong> Audience</a></li>
<li>
<a href=/bgnet/docs/intro/#12-platform-and-compiler><strong>1.2</strong> Platform and Compiler</a></li>
<li>
<a href=/bgnet/docs/intro/#13-official-homepage-and-books-for-sale><strong>1.3</strong> Official Homepage and Books For Sale</a></li>
<li>
<a href=/bgnet/docs/intro/#solaris><strong>1.4</strong> Note for Solaris/SunOS Programmers</a></li>
<li>
<a href=/bgnet/docs/intro/#windows><strong>1.5</strong> Note for Windows Programmers</a></li>
<li>
<a href=/bgnet/docs/intro/#16-email-policy><strong>1.6</strong> Email Policy</a></li>
<li>
<a href=/bgnet/docs/intro/#17-mirroring><strong>1.7</strong> Mirroring</a></li>
<li>
<a href=/bgnet/docs/intro/#18-note-for-translators><strong>1.8</strong> Note for Translators</a></li>
<li>
<a href=/bgnet/docs/intro/#legal><strong>1.9</strong> Copyright, Distribution, and Legal</a></li>
<li>
<a href=/bgnet/docs/intro/#110-dedication><strong>1.10</strong> Dedication</a></li>
<li>
<a href=/bgnet/docs/intro/#111-publishing-information><strong>1.11</strong> Publishing Information</a></li>
</ul>
</li>
<li>
<a href=/bgnet/docs/what-is-a-socket><strong>2</strong> What is a socket?</a>
<ul>
<li>
<a href=/bgnet/docs/what-is-a-socket/#21-two-types-of-internet-sockets><strong>2.1</strong> Two Types of Internet Sockets</a></li>
<li>
<a href=/bgnet/docs/what-is-a-socket/#lowlevel><strong>2.2</strong> Low level Nonsense and Network Theory</a></li>
</ul>
</li>
<li>
<a href=/bgnet/docs/ip-addresses-structs-and-data-munging><strong>3</strong> IP Addresses, structs, and Data Munging</a>
<ul>
<li>
<a href=/bgnet/docs/ip-addresses-structs-and-data-munging/#31-ip-addresses-versions-4-and-6><strong>3.1</strong> IP Addresses, versions 4 and 6</a>
<ul>
<li>
<a href=/bgnet/docs/ip-addresses-structs-and-data-munging/#311-subnets><strong>3.1.1</strong> Subnets</a></li>
<li>
<a href=/bgnet/docs/ip-addresses-structs-and-data-munging/#312-port-numbers><strong>3.1.2</strong> Port Numbers</a></li>
</ul>
</li>
<li>
<a href=/bgnet/docs/ip-addresses-structs-and-data-munging/#32-byte-order><strong>3.2</strong> Byte Order</a></li>
<li>
<a href=/bgnet/docs/ip-addresses-structs-and-data-munging/#structs><strong>3.3</strong> structs</a></li>
<li>
<a href=/bgnet/docs/ip-addresses-structs-and-data-munging/#34-ip-addresses-part-deux><strong>3.4</strong> IP Addresses, Part Deux</a>
<ul>
<li>
<a href=/bgnet/docs/ip-addresses-structs-and-data-munging/#341-private-or-disconnected-networks><strong>3.4.1</strong> Private (Or Disconnected) Networks</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href=/bgnet/docs/jumping-from-ipv4-to-ipv6><strong>4</strong> Jumping from IPv4 to IPv6</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust><strong>5</strong> System Calls or Bust</a>
<ul>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#51-getaddrinfo---prepare-to-launch><strong>5.1</strong> getaddrinfo()—Prepare to launch!</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#socket><strong>5.2</strong> socket()—Get the File Descriptor!</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#bind><strong>5.3</strong> bind()—What port am I on?</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#connect><strong>5.4</strong> connect()—Hey, you!</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#listen><strong>5.5</strong> listen()—Will somebody please call me?</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#56-accept---thank-you-for-calling-port-3490><strong>5.6</strong> accept()—“Thank you for calling port 3490.”</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#sendrecv><strong>5.7</strong> send() and recv()—Talk to me, baby!</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#sendtorecv><strong>5.8</strong> sendto() and recvfrom()—Talk to me, DGRAM-style</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#59-close-and-shutdown---get-outta-my-face><strong>5.9</strong> close() and shutdown()—Get outta my face!</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#510-getpeername---who-are-you><strong>5.10</strong> getpeername()—Who are you?</a></li>
<li>
<a href=/bgnet/docs/system-calls-or-bust/#511-gethostname---who-am-i><strong>5.11</strong> gethostname()—Who am I?</a></li>
</ul>
</li>
<li>
<a href=/bgnet/docs/client-server-background><strong>6</strong> Client-Server Background</a>
<ul>
<li>
<a href=/bgnet/docs/client-server-background/#61-a-simple-stream-server><strong>6.1</strong> A Simple Stream Server</a></li>
<li>
<a href=/bgnet/docs/client-server-background/#62-a-simple-stream-client><strong>6.2</strong> A Simple Stream Client</a></li>
<li>
<a href=/bgnet/docs/client-server-background/#datagram><strong>6.3</strong> Datagram Sockets</a></li>
</ul>
</li>
<li>
<a href=/bgnet/docs/slightly-advanced-techniques><strong>7</strong> Slightly Advanced Techniques</a>
<ul>
<li>
<a href=/bgnet/docs/slightly-advanced-techniques/#blocking><strong>7.1</strong> Blocking</a></li>
<li>
<a href=/bgnet/docs/slightly-advanced-techniques/#poll><strong>7.2</strong> poll()—Synchronous I/O Multiplexing</a></li>
<li>
<a href=/bgnet/docs/slightly-advanced-techniques/#select><strong>7.3</strong> select()—Synchronous I/O Multiplexing, Old School</a></li>
<li>
<a href=/bgnet/docs/slightly-advanced-techniques/#sendall><strong>7.4</strong> Handling Partial <code>send()</code>s</a></li>
<li>
<a href=/bgnet/docs/slightly-advanced-techniques/#serialization><strong>7.5</strong> Serialization&mdash;How to Pack Data</a></li>
<li>
<a href=/bgnet/docs/slightly-advanced-techniques/#sonofdataencap><strong>7.6</strong> Son of Data Encapsulation</a></li>
<li>
<a href=/bgnet/docs/slightly-advanced-techniques/#77-broadcast-packets---hello-world><strong>7.7</strong> Broadcast Packets&mdash;Hello, World!</a></li>
</ul>
</li>
<li>
<a href=/bgnet/docs/common-questions><strong>8</strong> Common Questions</a>
<br></li>
</ul>
<ul>
<li>
<a href=https://github.com/solareenlo/bgnet target=_blank rel=noopener>
Github
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/bgnet/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>8 Common Questions</strong>
<label for=toc-control>
<img src=/bgnet/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#8-common-questions>8 Common Questions</a>
<ul>
<li>
<ul>
<li><a href=#81-ヘッダーファイルはどこで入手できますか>8.1 ヘッダーファイルはどこで入手できますか？</a></li>
<li><a href=#82-bind-が-address-already-in-use-と報告した場合どうすればよいのでしょうか>8.2 <code>bind()</code> が &ldquo;Address already in use&rdquo; と報告した場合、どうすればよいのでしょうか？</a></li>
<li><a href=#83-システム上のオープンソケットのリストを取得するにはどうすればよいですか>8.3 システム上のオープンソケットのリストを取得するにはどうすればよいですか？</a></li>
<li><a href=#84-ルーティングテーブルを見るにはどうしたらいいですか>8.4 ルーティングテーブルを見るにはどうしたらいいですか？</a></li>
<li><a href=#85-クライアントとサーバのプログラムが1台しかない場合どのように実行すればよいのでしょうかネットワークプログラムを書くのにネットワークは必要ないのですか>8.5 クライアントとサーバのプログラムが1台しかない場合、どのように実行すればよいのでしょうか？ネットワークプログラムを書くのにネットワークは必要ないのですか？</a></li>
<li><a href=#86-リモート側が接続を閉じたかどうかを判断するにはどうすればよいですか>8.6 リモート側が接続を閉じたかどうかを判断するにはどうすればよいですか？</a></li>
<li><a href=#87-ping-ユーティリティを実装するにはicmp-とは何ですか生ソケットと-sock_raw-についてもっと詳しく知りたいのですがどこに行けばよいですか>8.7 &ldquo;ping&rdquo; ユーティリティを実装するには？ICMP とは何ですか？生ソケットと <code>SOCK_RAW</code> についてもっと詳しく知りたいのですが、どこに行けばよいですか?</a></li>
<li><a href=#88-connect-の呼び出しのタイムアウトを変更または短縮するにはどうすればよいですか>8.8 <code>connect()</code> の呼び出しのタイムアウトを変更または短縮するにはどうすればよいですか？</a></li>
<li><a href=#89-windows-用にビルドするにはどうしたらいいですか>8.9 Windows 用にビルドするにはどうしたらいいですか？</a></li>
<li><a href=#810-solarissunos-用にビルドするにはどうしたらいいですかコンパイルしようとするとリンカエラーが出ます>8.10 Solaris/SunOS 用にビルドするにはどうしたらいいですか？コンパイルしようとするとリンカエラーが出ます！</a></li>
<li><a href=#811-select-がシグナルで落ち続けるのはなぜか>8.11 <code>select()</code> がシグナルで落ち続けるのはなぜか？</a></li>
<li><a href=#812-recv-の呼び出しにタイムアウトを実装するにはどうすればよいですか>8.12 <code>recv()</code> の呼び出しにタイムアウトを実装するにはどうすればよいですか？</a></li>
<li><a href=#813-ソケットで送信する前にデータを暗号化または圧縮するにはどうすればよいですか>8.13 ソケットで送信する前にデータを暗号化または圧縮するにはどうすればよいですか？</a></li>
<li><a href=#814-pf_inet-をずっと見ているのですがこれは何ですかaf_inetと関係があるのでしょうか>8.14 &ldquo;<code>PF_INET</code>&rdquo; をずっと見ているのですが、これは何ですか？<code>AF_INET</code>と関係があるのでしょうか？</a></li>
<li><a href=#815-クライアントからシェルコマンドを受け取って実行するサーバを書くにはどうしたらいいでしょうか>8.15 クライアントからシェルコマンドを受け取って実行するサーバを書くにはどうしたらいいでしょうか？</a></li>
<li><a href=#816-slew-でデータを送っているのですがrecv-すると一度に-536-バイトか-1460-バイトしか受信できませんしかし私のローカルマシンで実行するとすべてのデータを同時に受信することができますどうなっているのでしょうか>8.16 slew でデータを送っているのですが、<code>recv()</code> すると、一度に 536 バイトか 1460 バイトしか受信できません。しかし、私のローカルマシンで実行すると、すべてのデータを同時に受信することができます。どうなっているのでしょうか？</a></li>
<li><a href=#817-私は-windows-マシンを使っていますがfork-システムコールも-struct-sigaction-のようなものも持っていませんどうしたらいいでしょうか>8.17 私は Windows マシンを使っていますが、<code>fork()</code> システムコールも <code>struct sigaction</code> のようなものも持っていません。どうしたらいいでしょうか？</a></li>
<li><a href=#818-ファイアウォールの内側にいるのですがファイアウォールの外側にいる人に私の-ip-アドレスを知らせて私のマシンに接続できるようにするにはどうしたらよいでしょうか>8.18 ファイアウォールの内側にいるのですが、ファイアウォールの外側にいる人に私の IP アドレスを知らせて、私のマシンに接続できるようにするにはどうしたらよいでしょうか？</a></li>
<li><a href=#819-パケットスニファーの書き方を教えてくださいイーサネットインタフェースをプロミスキャスモードにするにはどうしたらよいですか>8.19 パケットスニファーの書き方を教えてください。イーサネットインタフェースをプロミスキャスモードにするにはどうしたらよいですか?</a></li>
<li><a href=#820-tcpudp-ソケットにカスタムタイムアウト値を設定するにはどうすればよいですか>8.20 TCP/UDP ソケットにカスタムタイムアウト値を設定するにはどうすればよいですか？</a></li>
<li><a href=#821-どのポートが使用可能かどうすれば分かりますか公式なポート番号の一覧はありますか>8.21 どのポートが使用可能か、どうすれば分かりますか？&ldquo;公式"なポート番号の一覧はありますか？</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=8-common-questions>
8 Common Questions
<a class=anchor href=#8-common-questions>#</a>
</h1>
<h3 id=81-ヘッダーファイルはどこで入手できますか>
8.1 ヘッダーファイルはどこで入手できますか？
<a class=anchor href=#81-%e3%83%98%e3%83%83%e3%83%80%e3%83%bc%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%af%e3%81%a9%e3%81%93%e3%81%a7%e5%85%a5%e6%89%8b%e3%81%a7%e3%81%8d%e3%81%be%e3%81%99%e3%81%8b>#</a>
</h3>
<p>もし、あなたのシステムに既にないのであれば、おそらく必要ないでしょう。あなたのプラットフォームのマニュアルを参照してください。Windows 用にビルドする場合は、<code>#include &lt;winsock.h></code> だけが必要です。</p>
<h3 id=82-bind-が-address-already-in-use-と報告した場合どうすればよいのでしょうか>
8.2 <code>bind()</code> が &ldquo;Address already in use&rdquo; と報告した場合、どうすればよいのでしょうか？
<a class=anchor href=#82-bind-%e3%81%8c-address-already-in-use-%e3%81%a8%e5%a0%b1%e5%91%8a%e3%81%97%e3%81%9f%e5%a0%b4%e5%90%88%e3%81%a9%e3%81%86%e3%81%99%e3%82%8c%e3%81%b0%e3%82%88%e3%81%84%e3%81%ae%e3%81%a7%e3%81%97%e3%82%87%e3%81%86%e3%81%8b>#</a>
</h3>
<p>リスニングしているソケットで <code>SO_REUSEADDR</code> オプションを指定して <code>setsockopt()</code> を使用する必要があります。例として、
<a href=/bgnet/docs/system-calls-or-bust/#bind><code>bind()</code></a> の章と
<a href=/bgnet/docs/slightly-advanced-techniques/#select><code>select()</code></a> の章をチェックしてみてください。</p>
<h3 id=83-システム上のオープンソケットのリストを取得するにはどうすればよいですか>
8.3 システム上のオープンソケットのリストを取得するにはどうすればよいですか？
<a class=anchor href=#83-%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e4%b8%8a%e3%81%ae%e3%82%aa%e3%83%bc%e3%83%97%e3%83%b3%e3%82%bd%e3%82%b1%e3%83%83%e3%83%88%e3%81%ae%e3%83%aa%e3%82%b9%e3%83%88%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%99%e3%82%8c%e3%81%b0%e3%82%88%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p><code>netstat</code> を使用します。詳しくは <code>man</code> ページをチェックしてください。しかし、タイプするだけで良い出力が得られるはずです。</p>
<pre tabindex=0><code>$ netstat
</code></pre><p>唯一のコツは、どのソケットがどのプログラムに関連付けられているかを判断することです。<code>:-)</code></p>
<h3 id=84-ルーティングテーブルを見るにはどうしたらいいですか>
8.4 ルーティングテーブルを見るにはどうしたらいいですか？
<a class=anchor href=#84-%e3%83%ab%e3%83%bc%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0%e3%83%86%e3%83%bc%e3%83%96%e3%83%ab%e3%82%92%e8%a6%8b%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%97%e3%81%9f%e3%82%89%e3%81%84%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p><code>route</code> コマンド（ほとんどの Linux では <code>/sbin</code> にあります）または <code>netstat -r</code> コマンドを実行します。</p>
<h3 id=85-クライアントとサーバのプログラムが1台しかない場合どのように実行すればよいのでしょうかネットワークプログラムを書くのにネットワークは必要ないのですか>
8.5 クライアントとサーバのプログラムが1台しかない場合、どのように実行すればよいのでしょうか？ネットワークプログラムを書くのにネットワークは必要ないのですか？
<a class=anchor href=#85-%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88%e3%81%a8%e3%82%b5%e3%83%bc%e3%83%90%e3%81%ae%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%a0%e3%81%8c1%e5%8f%b0%e3%81%97%e3%81%8b%e3%81%aa%e3%81%84%e5%a0%b4%e5%90%88%e3%81%a9%e3%81%ae%e3%82%88%e3%81%86%e3%81%ab%e5%ae%9f%e8%a1%8c%e3%81%99%e3%82%8c%e3%81%b0%e3%82%88%e3%81%84%e3%81%ae%e3%81%a7%e3%81%97%e3%82%87%e3%81%86%e3%81%8b%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%a0%e3%82%92%e6%9b%b8%e3%81%8f%e3%81%ae%e3%81%ab%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e3%81%af%e5%bf%85%e8%a6%81%e3%81%aa%e3%81%84%e3%81%ae%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p>幸いなことに、事実上すべてのマシンは、カーネル内に配置され、ネットワークカードのふりをするループバックネットワーク"デバイス"を実装しています。（これはルーティングテーブルで &ldquo;<code>lo</code>&rdquo; としてリストされるインターフェースです。）</p>
<p>あなたが &ldquo;<code>goat</code>&rdquo; という名前のマシンにログインしていると仮定します。あるウィンドウでクライアントを、別のウィンドウでサーバを実行します。あるいは、サーバをバックグラウンドで起動し（"<code>server &</code>"）、同じウィンドウでクライアントを実行します。ループバックデバイスの利点は、<code>client goat</code> か <code>client localhost</code>（<code>localhost</code> は <code>/etc/hosts</code> ファイルで定義されていると思われるので）を使えば、ネットワークなしでクライアントがサーバと通信できるようになることです！</p>
<p>つまり、ネットワークに接続されていない1台のマシンで動作させるために、コードの変更は一切必要ないのです！ハッザー！</p>
<h3 id=86-リモート側が接続を閉じたかどうかを判断するにはどうすればよいですか>
8.6 リモート側が接続を閉じたかどうかを判断するにはどうすればよいですか？
<a class=anchor href=#86-%e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e5%81%b4%e3%81%8c%e6%8e%a5%e7%b6%9a%e3%82%92%e9%96%89%e3%81%98%e3%81%9f%e3%81%8b%e3%81%a9%e3%81%86%e3%81%8b%e3%82%92%e5%88%a4%e6%96%ad%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%99%e3%82%8c%e3%81%b0%e3%82%88%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p><code>recv()</code> が <code>0</code> を返すのでわかります。</p>
<h3 id=87-ping-ユーティリティを実装するにはicmp-とは何ですか生ソケットと-sock_raw-についてもっと詳しく知りたいのですがどこに行けばよいですか>
8.7 &ldquo;ping&rdquo; ユーティリティを実装するには？ICMP とは何ですか？生ソケットと <code>SOCK_RAW</code> についてもっと詳しく知りたいのですが、どこに行けばよいですか?
<a class=anchor href=#87-ping-%e3%83%a6%e3%83%bc%e3%83%86%e3%82%a3%e3%83%aa%e3%83%86%e3%82%a3%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b%e3%81%ab%e3%81%aficmp-%e3%81%a8%e3%81%af%e4%bd%95%e3%81%a7%e3%81%99%e3%81%8b%e7%94%9f%e3%82%bd%e3%82%b1%e3%83%83%e3%83%88%e3%81%a8-sock_raw-%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6%e3%82%82%e3%81%a3%e3%81%a8%e8%a9%b3%e3%81%97%e3%81%8f%e7%9f%a5%e3%82%8a%e3%81%9f%e3%81%84%e3%81%ae%e3%81%a7%e3%81%99%e3%81%8c%e3%81%a9%e3%81%93%e3%81%ab%e8%a1%8c%e3%81%91%e3%81%b0%e3%82%88%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p>生ソケットに関するすべての疑問は、
<a href=/bgnet/#books>W. Richard Stevens の UNIX Network Programming books</a> で解決されるでしょう。また、
<a href=http://www.unpbook.com/src.html>オンラインの Stevens の UNIX Network Programming</a> のソースコードの <code>ping/</code> サブディレクトリも見てみてください。</p>
<h3 id=88-connect-の呼び出しのタイムアウトを変更または短縮するにはどうすればよいですか>
8.8 <code>connect()</code> の呼び出しのタイムアウトを変更または短縮するにはどうすればよいですか？
<a class=anchor href=#88-connect-%e3%81%ae%e5%91%bc%e3%81%b3%e5%87%ba%e3%81%97%e3%81%ae%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%a2%e3%82%a6%e3%83%88%e3%82%92%e5%a4%89%e6%9b%b4%e3%81%be%e3%81%9f%e3%81%af%e7%9f%ad%e7%b8%ae%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%99%e3%82%8c%e3%81%b0%e3%82%88%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p>W. Richard Stevens と全く同じ答えを出すのではなく、
<a href=http://www.unpbook.com/src.html>UNIX Network Programming のソースコードにある <code>lib/connect_nonb.c</code></a> を参照することにしましょう。</p>
<p>その要点は、<code>socket()</code> でソケットディスクリプタを作成し、
<a href=/bgnet/docs/slightly-advanced-techniques/#blocking>それをノンブロッキングに設定</a>して <code>connect()</code> を呼び、すべてがうまくいけば <code>connect()</code> は直ちに <code>-1</code> を返して <code>errno</code> は <code>EINPROGRESS</code> に設定されるということです。その後、好きなタイムアウトで
<a href=/bgnet/docs/slightly-advanced-techniques/#select><code>select()</code></a> を呼び出し、ソケットディスクリプタをリードとライトの両方で渡します。タイムアウトしなければ、<code>connect()</code> の呼び出しが完了したことになります。このとき、<code>getsockopt()</code> に <code>SO_ERROR</code> オプションをつけて <code>connect()</code> 呼び出しからの戻り値を取得する必要があります（エラーがなければ <code>0</code> になるはずです）。</p>
<p>最後に、データ転送を開始する前に、ソケットを再びブロッキングに設定する必要があります。</p>
<p>この方法には、接続中に何か他のことをすることができるという利点もあることに注意してください。例えば、タイムアウトを 500ms のような低い値に設定し、タイムアウトするたびに画面上のインジケータを更新し、それから再び <code>select() </code> を呼び出すことができます。例えば、<code>select()</code> を20回ほど呼び出してタイムアウトしたら、そろそろ接続をあきらめる時期だとわかるでしょう。</p>
<p>私が言ったように、スティーブンスのソースに完璧に優れた例があるので、チェックしてみてください。</p>
<h3 id=89-windows-用にビルドするにはどうしたらいいですか>
8.9 Windows 用にビルドするにはどうしたらいいですか？
<a class=anchor href=#89-windows-%e7%94%a8%e3%81%ab%e3%83%93%e3%83%ab%e3%83%89%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%97%e3%81%9f%e3%82%89%e3%81%84%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p>まず、Windows を削除し、Linux または BSD をインストールします。<code>};-)</code>。いや、実際には、導入部の
<a href=/bgnet/docs/intro/#windows>Windows 用のビルドの章</a>を見ればいいんですけどね。</p>
<h3 id=810-solarissunos-用にビルドするにはどうしたらいいですかコンパイルしようとするとリンカエラーが出ます>
8.10 Solaris/SunOS 用にビルドするにはどうしたらいいですか？コンパイルしようとするとリンカエラーが出ます！
<a class=anchor href=#810-solarissunos-%e7%94%a8%e3%81%ab%e3%83%93%e3%83%ab%e3%83%89%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%97%e3%81%9f%e3%82%89%e3%81%84%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%ab%e3%81%97%e3%82%88%e3%81%86%e3%81%a8%e3%81%99%e3%82%8b%e3%81%a8%e3%83%aa%e3%83%b3%e3%82%ab%e3%82%a8%e3%83%a9%e3%83%bc%e3%81%8c%e5%87%ba%e3%81%be%e3%81%99>#</a>
</h3>
<p>リンカーエラーは、Sun ボックスがソケットライブラリを自動的にコンパイルしないために起こります。この方法の例については、導入部の
<a href=/bgnet/docs/intro/#solaris>Solaris/SunOS 用のビルドに関する章</a> を参照してください。</p>
<h3 id=811-select-がシグナルで落ち続けるのはなぜか>
8.11 <code>select()</code> がシグナルで落ち続けるのはなぜか？
<a class=anchor href=#811-select-%e3%81%8c%e3%82%b7%e3%82%b0%e3%83%8a%e3%83%ab%e3%81%a7%e8%90%bd%e3%81%a1%e7%b6%9a%e3%81%91%e3%82%8b%e3%81%ae%e3%81%af%e3%81%aa%e3%81%9c%e3%81%8b>#</a>
</h3>
<p>シグナルはブロックされたシステムコールに <code>-1</code> を返し、<code>errno</code> に <code>EINTR</code> をセットする傾向があります。<code>sigaction()</code> でシグナルハンドラをセットアップするときに、フラグ <code>SA_RESTART</code> を設定することができます。これは、システムコールが中断された後に再開することを想定したものです。</p>
<p>当然ながら、いつもうまくいくわけではありません。</p>
<p>私のお気に入りの解決策は、<code>goto</code> ステートメントを使うことです。これは教授をイライラさせるだけなので、ぜひやってみてください。</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-{.c data-lang={.c>select_restart:
<span style=color:#719e07>if</span> ((err <span style=color:#719e07>=</span> select(fdmax<span style=color:#719e07>+</span><span style=color:#2aa198>1</span>, <span style=color:#719e07>&amp;</span>readfds, <span style=color:#b58900>NULL</span>, <span style=color:#b58900>NULL</span>, <span style=color:#b58900>NULL</span>)) <span style=color:#719e07>==</span> <span style=color:#719e07>-</span><span style=color:#2aa198>1</span>) {
    <span style=color:#719e07>if</span> (errno <span style=color:#719e07>==</span> EINTR) {
        <span style=color:#586e75>// some signal just interrupted us, so restart
</span><span style=color:#586e75></span>        <span style=color:#719e07>goto</span> select_restart;
    }
    <span style=color:#586e75>// handle the real error here:
</span><span style=color:#586e75></span>    perror(<span style=color:#2aa198>&#34;select&#34;</span>);
}
</code></pre></div><p>もちろん、この場合は <code>goto</code> を使う必要はありません。他の構造体を使用して制御することができます。しかし、私は <code>goto</code> 文の方が実際きれいだと思うんです。</p>
<h3 id=812-recv-の呼び出しにタイムアウトを実装するにはどうすればよいですか>
8.12 <code>recv()</code> の呼び出しにタイムアウトを実装するにはどうすればよいですか？
<a class=anchor href=#812-recv-%e3%81%ae%e5%91%bc%e3%81%b3%e5%87%ba%e3%81%97%e3%81%ab%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%a2%e3%82%a6%e3%83%88%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%99%e3%82%8c%e3%81%b0%e3%82%88%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p>
<a href=/bgnet/docs/slightly-advanced-techniques/#select><code>select()</code></a>を使いましょう！これは、読み込みたいソケットディスクリプタに対して、タイムアウトパラメータを指定することができます。あるいは、このように関数全体を一つの関数で包むこともできます。</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-{.c data-lang={.c><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;unistd.h&gt;</span><span style=color:#719e07>
</span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;sys/time.h&gt;</span><span style=color:#719e07>
</span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;sys/types.h&gt;</span><span style=color:#719e07>
</span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;sys/socket.h&gt;</span><span style=color:#719e07>
</span><span style=color:#719e07></span>
<span style=color:#dc322f>int</span> <span style=color:#268bd2>recvtimeout</span>(<span style=color:#dc322f>int</span> s, <span style=color:#dc322f>char</span> <span style=color:#719e07>*</span>buf, <span style=color:#dc322f>int</span> len, <span style=color:#dc322f>int</span> timeout)
{
    fd_set fds;
    <span style=color:#dc322f>int</span> n;
    <span style=color:#719e07>struct</span> timeval tv;

    <span style=color:#586e75>// set up the file descriptor set
</span><span style=color:#586e75></span>    FD_ZERO(<span style=color:#719e07>&amp;</span>fds);
    FD_SET(s, <span style=color:#719e07>&amp;</span>fds);

    <span style=color:#586e75>// set up the struct timeval for the timeout
</span><span style=color:#586e75></span>    tv.tv_sec <span style=color:#719e07>=</span> timeout;
    tv.tv_usec <span style=color:#719e07>=</span> <span style=color:#2aa198>0</span>;

    <span style=color:#586e75>// wait until timeout or data received
</span><span style=color:#586e75></span>    n <span style=color:#719e07>=</span> select(s<span style=color:#719e07>+</span><span style=color:#2aa198>1</span>, <span style=color:#719e07>&amp;</span>fds, <span style=color:#b58900>NULL</span>, <span style=color:#b58900>NULL</span>, <span style=color:#719e07>&amp;</span>tv);
    <span style=color:#719e07>if</span> (n <span style=color:#719e07>==</span> <span style=color:#2aa198>0</span>) <span style=color:#719e07>return</span> <span style=color:#719e07>-</span><span style=color:#2aa198>2</span>; <span style=color:#586e75>// timeout!
</span><span style=color:#586e75></span>    <span style=color:#719e07>if</span> (n <span style=color:#719e07>==</span> <span style=color:#719e07>-</span><span style=color:#2aa198>1</span>) <span style=color:#719e07>return</span> <span style=color:#719e07>-</span><span style=color:#2aa198>1</span>; <span style=color:#586e75>// error
</span><span style=color:#586e75></span>
    <span style=color:#586e75>// data must be here, so do a normal recv()
</span><span style=color:#586e75></span>    <span style=color:#719e07>return</span> recv(s, buf, len, <span style=color:#2aa198>0</span>);
}
.
.
.
<span style=color:#586e75>// Sample call to recvtimeout():
</span><span style=color:#586e75></span>n <span style=color:#719e07>=</span> recvtimeout(s, buf, <span style=color:#719e07>sizeof</span> buf, <span style=color:#2aa198>10</span>); <span style=color:#586e75>// 10 second timeout
</span><span style=color:#586e75></span>
<span style=color:#719e07>if</span> (n <span style=color:#719e07>==</span> <span style=color:#719e07>-</span><span style=color:#2aa198>1</span>) {
    <span style=color:#586e75>// error occurred
</span><span style=color:#586e75></span>    perror(<span style=color:#2aa198>&#34;recvtimeout&#34;</span>);
}
<span style=color:#719e07>else</span> <span style=color:#719e07>if</span> (n <span style=color:#719e07>==</span> <span style=color:#719e07>-</span><span style=color:#2aa198>2</span>) {
    <span style=color:#586e75>// timeout occurred
</span><span style=color:#586e75></span>} <span style=color:#719e07>else</span> {
    <span style=color:#586e75>// got some data in buf
</span><span style=color:#586e75></span>}
.
.
.
</code></pre></div><p><code>recvtimeout()</code> はタイムアウトした場合、<code>-2</code> を返すことに注意してください。なぜ <code>0</code> を返さないのでしょうか？そうですね、思い出してみてください、<code>recv()</code> を呼び出したときに <code>0</code> という値が返ってきたら、リモート側が接続を閉じたことを意味します。そのため、この戻り値はすでに話されており、<code>-1</code> は &ldquo;error&rdquo; を意味します。そこで、タイムアウトのインジケータとして <code>-2</code> を選択しました。</p>
<h3 id=813-ソケットで送信する前にデータを暗号化または圧縮するにはどうすればよいですか>
8.13 ソケットで送信する前にデータを暗号化または圧縮するにはどうすればよいですか？
<a class=anchor href=#813-%e3%82%bd%e3%82%b1%e3%83%83%e3%83%88%e3%81%a7%e9%80%81%e4%bf%a1%e3%81%99%e3%82%8b%e5%89%8d%e3%81%ab%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e6%9a%97%e5%8f%b7%e5%8c%96%e3%81%be%e3%81%9f%e3%81%af%e5%9c%a7%e7%b8%ae%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%99%e3%82%8c%e3%81%b0%e3%82%88%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p>暗号化を行う簡単な方法として、SSL（セキュア・ソケット・レイヤー）を使用する方法がありますが、このガイドの範囲を超えています。（詳しくは
<a href=https://www.openssl.org/>OpenSSL プロジェクト</a>を見てください。）</p>
<p>しかし、独自のコンプレッサーや暗号化システムを導入する場合は、データが両端間で一連のステップを通過すると考えればよいのです。各ステップは、何らかの形でデータを変更します。</p>
<ol>
<li>サーバがファイルやどこからでもデータを読み取ります。</li>
<li>サーバがデータを暗号化・圧縮します（この部分を追加します）。</li>
<li>サーバが暗号化されたデータを <code>send()</code> します。</li>
</ol>
<p>今度はその逆です。</p>
<ol>
<li>クライアントが暗号化されたデータを <code>recv()</code> します。</li>
<li>クライアントがデータを復号・伸張します（この部分はあなたが追加します）。</li>
<li>クライアントがデータをファイル（または任意の場所）に書き込みます。</li>
</ol>
<p>圧縮して暗号化するなら、最初に圧縮することだけは忘れないでください。<code>:-)</code></p>
<p>ただ、サーバがやったことをクライアントがきちんと元に戻してくれれば、いくら中間ステップを追加しても、最終的にはデータは大丈夫です。</p>
<p>つまり、私のコードを使うために必要なことは、データが読み込まれる場所と、ネットワーク上で（<code>send()</code> を使って）データが送信される場所の間にある場所を見つけ、そこに暗号化を行うコードを貼り付けるだけです。</p>
<h3 id=814-pf_inet-をずっと見ているのですがこれは何ですかaf_inetと関係があるのでしょうか>
8.14 &ldquo;<code>PF_INET</code>&rdquo; をずっと見ているのですが、これは何ですか？<code>AF_INET</code>と関係があるのでしょうか？
<a class=anchor href=#814-pf_inet-%e3%82%92%e3%81%9a%e3%81%a3%e3%81%a8%e8%a6%8b%e3%81%a6%e3%81%84%e3%82%8b%e3%81%ae%e3%81%a7%e3%81%99%e3%81%8c%e3%81%93%e3%82%8c%e3%81%af%e4%bd%95%e3%81%a7%e3%81%99%e3%81%8baf_inet%e3%81%a8%e9%96%a2%e4%bf%82%e3%81%8c%e3%81%82%e3%82%8b%e3%81%ae%e3%81%a7%e3%81%97%e3%82%87%e3%81%86%e3%81%8b>#</a>
</h3>
<p>はい、そうです。詳しくは
<a href=/bgnet/docs/system-calls-or-bust/#socket><code>socket()</code> の項</a>を参照してください。</p>
<h3 id=815-クライアントからシェルコマンドを受け取って実行するサーバを書くにはどうしたらいいでしょうか>
8.15 クライアントからシェルコマンドを受け取って実行するサーバを書くにはどうしたらいいでしょうか？
<a class=anchor href=#815-%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88%e3%81%8b%e3%82%89%e3%82%b7%e3%82%a7%e3%83%ab%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89%e3%82%92%e5%8f%97%e3%81%91%e5%8f%96%e3%81%a3%e3%81%a6%e5%ae%9f%e8%a1%8c%e3%81%99%e3%82%8b%e3%82%b5%e3%83%bc%e3%83%90%e3%82%92%e6%9b%b8%e3%81%8f%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%97%e3%81%9f%e3%82%89%e3%81%84%e3%81%84%e3%81%a7%e3%81%97%e3%82%87%e3%81%86%e3%81%8b>#</a>
</h3>
<p>簡単のために、クライアントが <code>connect()</code>s, <code>send()</code>s, <code>close()</code>s で接続したとしましょう（つまり、クライアントが再び接続しない限り、その後のシステムコールはありません）。</p>
<p>クライアントがたどるプロセスはこうです。</p>
<ol>
<li>サーバに <code>connect()</code> します。</li>
<li><code>send("/sbin/ls > /tmp/client.out")</code></li>
<li>接続を <code>close()</code> します。</li>
</ol>
<p>一方、サーバはデータを処理し、実行します。</p>
<ol>
<li>クライアントからの接続を <code>accept()</code> します。</li>
<li>コマンド文字列を <code>recv(str)</code> します。</li>
<li>接続を <code>close()</code> します。</li>
<li><code>system(str)</code> を使ってコマンドを実行します。</li>
</ol>
<p>ご注意ください！サーバがクライアントの言うことを実行することは、リモートシェルアクセスを与えるようなもので、サーバに接続すると、あなたのアカウントに何かすることができます。例えば、上記の例で、クライアントが &ldquo;<code>rm -rf ~</code>&rdquo; と送ったらどうでしょう？それはあなたのアカウント内のすべてを削除してしまいます。</p>
<p>そこで、賢明にも、<code>foobar</code> ユーティリティのような、安全だとわかっているいくつかのユーティリティを除いて、クライアントが何も使えないようにするのです。</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#719e07>if</span> (<span style=color:#719e07>!</span>strncmp(str, <span style=color:#2aa198>&#34;foobar&#34;</span>, <span style=color:#2aa198>6</span>)) {
    sprintf(sysstr, <span style=color:#2aa198>&#34;%s &gt; /tmp/server.out&#34;</span>, str);
    system(sysstr);
}
</code></pre></div><p>しかし、残念ながらまだ安全ではありません。クライアントが &ldquo;<code>foobar; rm -rf ~</code>&rdquo; と入力したらどうでしょうか。最も安全なのは、コマンドの引数に含まれるすべての非英数字（適切であればスペースを含む）の前にエスケープ文字（"<code>\</code>"）を置く小さなルーチンを書くことです。</p>
<p>このように、クライアントが送信したものをサーバが実行し始めると、セキュリティはかなり大きな問題になります。</p>
<h3 id=816-slew-でデータを送っているのですがrecv-すると一度に-536-バイトか-1460-バイトしか受信できませんしかし私のローカルマシンで実行するとすべてのデータを同時に受信することができますどうなっているのでしょうか>
8.16 slew でデータを送っているのですが、<code>recv()</code> すると、一度に 536 バイトか 1460 バイトしか受信できません。しかし、私のローカルマシンで実行すると、すべてのデータを同時に受信することができます。どうなっているのでしょうか？
<a class=anchor href=#816-slew-%e3%81%a7%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e9%80%81%e3%81%a3%e3%81%a6%e3%81%84%e3%82%8b%e3%81%ae%e3%81%a7%e3%81%99%e3%81%8crecv-%e3%81%99%e3%82%8b%e3%81%a8%e4%b8%80%e5%ba%a6%e3%81%ab-536-%e3%83%90%e3%82%a4%e3%83%88%e3%81%8b-1460-%e3%83%90%e3%82%a4%e3%83%88%e3%81%97%e3%81%8b%e5%8f%97%e4%bf%a1%e3%81%a7%e3%81%8d%e3%81%be%e3%81%9b%e3%82%93%e3%81%97%e3%81%8b%e3%81%97%e7%a7%81%e3%81%ae%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e3%83%9e%e3%82%b7%e3%83%b3%e3%81%a7%e5%ae%9f%e8%a1%8c%e3%81%99%e3%82%8b%e3%81%a8%e3%81%99%e3%81%b9%e3%81%a6%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e5%90%8c%e6%99%82%e3%81%ab%e5%8f%97%e4%bf%a1%e3%81%99%e3%82%8b%e3%81%93%e3%81%a8%e3%81%8c%e3%81%a7%e3%81%8d%e3%81%be%e3%81%99%e3%81%a9%e3%81%86%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%84%e3%82%8b%e3%81%ae%e3%81%a7%e3%81%97%e3%82%87%e3%81%86%e3%81%8b>#</a>
</h3>
<p>物理媒体が処理できる最大サイズであるMTUに当たっています。ローカルマシンでは、8K 以上を問題なく処理できるループバックデバイスを使用しています。しかし、Ethernet では、ヘッダーを含めて 1500 バイトしか扱えないので、その限界にぶつかってしまうのです。モデムでは、576 MTU（これもヘッダ付き）で、さらに低い制限にぶつかります。</p>
<p>まず、すべてのデータが送信されていることを確認する必要があります。（詳しくは
<a href=/bgnet/docs/slightly-advanced-techniques/#sendall><code>sendall()</code></a> 関数の実装を参照してください。）それが確認できたら、すべてのデータが読み込まれるまで、ループで <code>recv()</code> を呼び出す必要があります。</p>
<p><code>recv()</code> を複数回呼び出して完全なデータパケットを受信する方法については、
<a href=/bgnet/docs/slightly-advanced-techniques/#sonofdataencap>7.6 Son of Data Encapsulation</a> の節を読んでください。</p>
<h3 id=817-私は-windows-マシンを使っていますがfork-システムコールも-struct-sigaction-のようなものも持っていませんどうしたらいいでしょうか>
8.17 私は Windows マシンを使っていますが、<code>fork()</code> システムコールも <code>struct sigaction</code> のようなものも持っていません。どうしたらいいでしょうか？
<a class=anchor href=#817-%e7%a7%81%e3%81%af-windows-%e3%83%9e%e3%82%b7%e3%83%b3%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%e3%81%84%e3%81%be%e3%81%99%e3%81%8cfork-%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e3%82%b3%e3%83%bc%e3%83%ab%e3%82%82-struct-sigaction-%e3%81%ae%e3%82%88%e3%81%86%e3%81%aa%e3%82%82%e3%81%ae%e3%82%82%e6%8c%81%e3%81%a3%e3%81%a6%e3%81%84%e3%81%be%e3%81%9b%e3%82%93%e3%81%a9%e3%81%86%e3%81%97%e3%81%9f%e3%82%89%e3%81%84%e3%81%84%e3%81%a7%e3%81%97%e3%82%87%e3%81%86%e3%81%8b>#</a>
</h3>
<p>もし、どこかにあるとすれば、コンパイラに同梱されているであろう POSIX ライブラリでしょう。私は Windows を持っていないので、答えようがないのですが、Microsoft には POSIX 互換性レイヤーがあり、そこに <code>fork()</code> があるように記憶しています。（そして多分、<code>sigaction</code> も。）</p>
<p>VC++ 付属のヘルプで &ldquo;fork&rdquo; または &ldquo;POSIX&rdquo; を検索して、何か手がかりがないか見てみてください。</p>
<p>もし、それでうまくいかない場合は、<code>fork()</code>/<code>sigaction</code> を捨てて、Win32 の <code>CreateProcess()</code> に置き換えてください。私は <code>CreateProcess()</code> の使い方を知りません。引数をたくさん取りますが、VC++ に付属するドキュメントに記載されているはずです。</p>
<h3 id=818-ファイアウォールの内側にいるのですがファイアウォールの外側にいる人に私の-ip-アドレスを知らせて私のマシンに接続できるようにするにはどうしたらよいでしょうか>
8.18 ファイアウォールの内側にいるのですが、ファイアウォールの外側にいる人に私の IP アドレスを知らせて、私のマシンに接続できるようにするにはどうしたらよいでしょうか？
<a class=anchor href=#818-%e3%83%95%e3%82%a1%e3%82%a4%e3%82%a2%e3%82%a6%e3%82%a9%e3%83%bc%e3%83%ab%e3%81%ae%e5%86%85%e5%81%b4%e3%81%ab%e3%81%84%e3%82%8b%e3%81%ae%e3%81%a7%e3%81%99%e3%81%8c%e3%83%95%e3%82%a1%e3%82%a4%e3%82%a2%e3%82%a6%e3%82%a9%e3%83%bc%e3%83%ab%e3%81%ae%e5%a4%96%e5%81%b4%e3%81%ab%e3%81%84%e3%82%8b%e4%ba%ba%e3%81%ab%e7%a7%81%e3%81%ae-ip-%e3%82%a2%e3%83%89%e3%83%ac%e3%82%b9%e3%82%92%e7%9f%a5%e3%82%89%e3%81%9b%e3%81%a6%e7%a7%81%e3%81%ae%e3%83%9e%e3%82%b7%e3%83%b3%e3%81%ab%e6%8e%a5%e7%b6%9a%e3%81%a7%e3%81%8d%e3%82%8b%e3%82%88%e3%81%86%e3%81%ab%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%97%e3%81%9f%e3%82%89%e3%82%88%e3%81%84%e3%81%a7%e3%81%97%e3%82%87%e3%81%86%e3%81%8b>#</a>
</h3>
<p>残念ながら、ファイアウォールの目的は、ファイアウォール外の人がファイアウォール内のマシンに接続するのを防ぐことなので、それを許可することは基本的にセキュリティ違反とみなされます。</p>
<p>これは、すべてが失われたということではありません。ひとつには、ファイアウォールがマスカレードやNATのようなことを行っている場合、しばしば <code>connect()</code> を通して接続することができます。自分が常に接続を開始するようにプログラムを設計すれば、うまくいくでしょう。</p>
<p>もしそれで満足できないなら、システム管理者に頼んでファイアウォールに穴を開けてもらい、人々があなたに接続できるようにすることができます。ファイアウォールは NAT ソフトウェアやプロキシなどを通して、あなたに転送することができます。</p>
<p>ファイアウォールの穴は、決して軽視できないものであることを認識しておいてください。悪い人が内部ネットワークにアクセスできないようにしなければなりません。初心者の場合、ソフトウェアを安全にするのは想像以上に難しいのです。</p>
<p>シスアドを怒らせないようにね。<code>;-)</code></p>
<h3 id=819-パケットスニファーの書き方を教えてくださいイーサネットインタフェースをプロミスキャスモードにするにはどうしたらよいですか>
8.19 パケットスニファーの書き方を教えてください。イーサネットインタフェースをプロミスキャスモードにするにはどうしたらよいですか?
<a class=anchor href=#819-%e3%83%91%e3%82%b1%e3%83%83%e3%83%88%e3%82%b9%e3%83%8b%e3%83%95%e3%82%a1%e3%83%bc%e3%81%ae%e6%9b%b8%e3%81%8d%e6%96%b9%e3%82%92%e6%95%99%e3%81%88%e3%81%a6%e3%81%8f%e3%81%a0%e3%81%95%e3%81%84%e3%82%a4%e3%83%bc%e3%82%b5%e3%83%8d%e3%83%83%e3%83%88%e3%82%a4%e3%83%b3%e3%82%bf%e3%83%95%e3%82%a7%e3%83%bc%e3%82%b9%e3%82%92%e3%83%97%e3%83%ad%e3%83%9f%e3%82%b9%e3%82%ad%e3%83%a3%e3%82%b9%e3%83%a2%e3%83%bc%e3%83%89%e3%81%ab%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%97%e3%81%9f%e3%82%89%e3%82%88%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p>ネットワークカードが"プロミスカスモード"の場合、このマシン宛のパケットだけでなく、すべてのパケットをオペレーティングシステムに転送することをご存じない方のために説明します。（しかし、イーサネットは IP より下位の層なので、すべての IP アドレスは効果的に転送されます。より詳しくは、
<a href=/bgnet/docs/what-is-a-socket/#lowlevel>Low Level Nonsense and Network Theory</a> の章をご覧ください)。</p>
<p>これは、パケットスニファーの仕組みの基本です。インターフェイスをプロミスカスモードにし、OSはワイヤー上を通過するすべてのパケットを取得します。 このデータを読むために、ある種のソケットを持っているはずです。</p>
<p>残念ながら、その答えはプラットフォームによって異なりますが、例えば &ldquo;windows promiscuous ioctl&rdquo; でググれば、おそらくどこかにたどり着けるはずです。Linux の場合は、
<a href=https://stackoverflow.com/questions/21323023/sniffing-an-ethernet-interface-on-linux>Stack Overflow のスレッド</a>にも有用そうなものがあります。</p>
<h3 id=820-tcpudp-ソケットにカスタムタイムアウト値を設定するにはどうすればよいですか>
8.20 TCP/UDP ソケットにカスタムタイムアウト値を設定するにはどうすればよいですか？
<a class=anchor href=#820-tcpudp-%e3%82%bd%e3%82%b1%e3%83%83%e3%83%88%e3%81%ab%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%a0%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%a2%e3%82%a6%e3%83%88%e5%80%a4%e3%82%92%e8%a8%ad%e5%ae%9a%e3%81%99%e3%82%8b%e3%81%ab%e3%81%af%e3%81%a9%e3%81%86%e3%81%99%e3%82%8c%e3%81%b0%e3%82%88%e3%81%84%e3%81%a7%e3%81%99%e3%81%8b>#</a>
</h3>
<p>お使いのシステムに依存します。ネットで <code>SO_RCVTIMEO</code> や <code>SO_SNDTIMEO</code>（<code>setsockopt()</code> で使用）を検索して、あなたのシステムがその機能をサポートしているかどうかを確認するとよいでしょう。</p>
<p>Linux のマニュアルでは，<code>alarm()</code> や <code>setitimer()</code> で代用することを勧めています．</p>
<h3 id=821-どのポートが使用可能かどうすれば分かりますか公式なポート番号の一覧はありますか>
8.21 どのポートが使用可能か、どうすれば分かりますか？&ldquo;公式"なポート番号の一覧はありますか？
<a class=anchor href=#821-%e3%81%a9%e3%81%ae%e3%83%9d%e3%83%bc%e3%83%88%e3%81%8c%e4%bd%bf%e7%94%a8%e5%8f%af%e8%83%bd%e3%81%8b%e3%81%a9%e3%81%86%e3%81%99%e3%82%8c%e3%81%b0%e5%88%86%e3%81%8b%e3%82%8a%e3%81%be%e3%81%99%e3%81%8b%e5%85%ac%e5%bc%8f%e3%81%aa%e3%83%9d%e3%83%bc%e3%83%88%e7%95%aa%e5%8f%b7%e3%81%ae%e4%b8%80%e8%a6%a7%e3%81%af%e3%81%82%e3%82%8a%e3%81%be%e3%81%99%e3%81%8b>#</a>
</h3>
<p>通常、これは問題ではありません。もしあなたが、例えばウェブサーバを書いているのであれば、よく知られているポート 80 をあなたのソフトウェアに使用するのは良い考えです。もし、自分専用のサーバを書くのであれば、適当にポートを選んで（ただし 1023 より大きい）試してみてください。</p>
<p>そのポートがすでに使われている場合、<code>bind()</code> しようとすると &ldquo;Address already in use&rdquo; というエラーが表示されます。他のポートを選んでください。（ソフトウェアのユーザが、設定ファイルやコマンドラインスイッチで別のポートを指定できるようにしておくとよいでしょう。）</p>
<p>IANA（Internet Assigned Numbers Authority）が管理している
<a href=https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml>公式ポート番号一覧</a>があります。そのリストにあるもの（1023 以上）があるからといって、そのポートを使ってはいけないというわけではありません。例えば、Id Software 社の DOOM は、それが何であれ、&ldquo;mdqs&rdquo; と同じポートを使っています。重要なのは、あなたがそのポートを使いたいときに、同じマシンの他の誰もそのポートを使っていないことです。</p>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div><a class="flex align-center" href=https://github.com/solareenlo/bgnet/commit/fc42677fd0a39db533709a20a48db6fdeeee9b7a title="Last modified by solareenlo | Jan 5, 2022" target=_blank rel=noopener>
<img src=/bgnet/svg/calendar.svg class=book-icon alt=Calendar>
<span>Jan 5, 2022</span>
</a>
</div>
<div>
<a class="flex align-center" href=https://github.com/solareenlo/bgnet/edit/master/content/content/docs/common-questions/_index.md target=_blank rel=noopener>
<img src=/bgnet/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span>
</a>
</div>
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#8-common-questions>8 Common Questions</a>
<ul>
<li>
<ul>
<li><a href=#81-ヘッダーファイルはどこで入手できますか>8.1 ヘッダーファイルはどこで入手できますか？</a></li>
<li><a href=#82-bind-が-address-already-in-use-と報告した場合どうすればよいのでしょうか>8.2 <code>bind()</code> が &ldquo;Address already in use&rdquo; と報告した場合、どうすればよいのでしょうか？</a></li>
<li><a href=#83-システム上のオープンソケットのリストを取得するにはどうすればよいですか>8.3 システム上のオープンソケットのリストを取得するにはどうすればよいですか？</a></li>
<li><a href=#84-ルーティングテーブルを見るにはどうしたらいいですか>8.4 ルーティングテーブルを見るにはどうしたらいいですか？</a></li>
<li><a href=#85-クライアントとサーバのプログラムが1台しかない場合どのように実行すればよいのでしょうかネットワークプログラムを書くのにネットワークは必要ないのですか>8.5 クライアントとサーバのプログラムが1台しかない場合、どのように実行すればよいのでしょうか？ネットワークプログラムを書くのにネットワークは必要ないのですか？</a></li>
<li><a href=#86-リモート側が接続を閉じたかどうかを判断するにはどうすればよいですか>8.6 リモート側が接続を閉じたかどうかを判断するにはどうすればよいですか？</a></li>
<li><a href=#87-ping-ユーティリティを実装するにはicmp-とは何ですか生ソケットと-sock_raw-についてもっと詳しく知りたいのですがどこに行けばよいですか>8.7 &ldquo;ping&rdquo; ユーティリティを実装するには？ICMP とは何ですか？生ソケットと <code>SOCK_RAW</code> についてもっと詳しく知りたいのですが、どこに行けばよいですか?</a></li>
<li><a href=#88-connect-の呼び出しのタイムアウトを変更または短縮するにはどうすればよいですか>8.8 <code>connect()</code> の呼び出しのタイムアウトを変更または短縮するにはどうすればよいですか？</a></li>
<li><a href=#89-windows-用にビルドするにはどうしたらいいですか>8.9 Windows 用にビルドするにはどうしたらいいですか？</a></li>
<li><a href=#810-solarissunos-用にビルドするにはどうしたらいいですかコンパイルしようとするとリンカエラーが出ます>8.10 Solaris/SunOS 用にビルドするにはどうしたらいいですか？コンパイルしようとするとリンカエラーが出ます！</a></li>
<li><a href=#811-select-がシグナルで落ち続けるのはなぜか>8.11 <code>select()</code> がシグナルで落ち続けるのはなぜか？</a></li>
<li><a href=#812-recv-の呼び出しにタイムアウトを実装するにはどうすればよいですか>8.12 <code>recv()</code> の呼び出しにタイムアウトを実装するにはどうすればよいですか？</a></li>
<li><a href=#813-ソケットで送信する前にデータを暗号化または圧縮するにはどうすればよいですか>8.13 ソケットで送信する前にデータを暗号化または圧縮するにはどうすればよいですか？</a></li>
<li><a href=#814-pf_inet-をずっと見ているのですがこれは何ですかaf_inetと関係があるのでしょうか>8.14 &ldquo;<code>PF_INET</code>&rdquo; をずっと見ているのですが、これは何ですか？<code>AF_INET</code>と関係があるのでしょうか？</a></li>
<li><a href=#815-クライアントからシェルコマンドを受け取って実行するサーバを書くにはどうしたらいいでしょうか>8.15 クライアントからシェルコマンドを受け取って実行するサーバを書くにはどうしたらいいでしょうか？</a></li>
<li><a href=#816-slew-でデータを送っているのですがrecv-すると一度に-536-バイトか-1460-バイトしか受信できませんしかし私のローカルマシンで実行するとすべてのデータを同時に受信することができますどうなっているのでしょうか>8.16 slew でデータを送っているのですが、<code>recv()</code> すると、一度に 536 バイトか 1460 バイトしか受信できません。しかし、私のローカルマシンで実行すると、すべてのデータを同時に受信することができます。どうなっているのでしょうか？</a></li>
<li><a href=#817-私は-windows-マシンを使っていますがfork-システムコールも-struct-sigaction-のようなものも持っていませんどうしたらいいでしょうか>8.17 私は Windows マシンを使っていますが、<code>fork()</code> システムコールも <code>struct sigaction</code> のようなものも持っていません。どうしたらいいでしょうか？</a></li>
<li><a href=#818-ファイアウォールの内側にいるのですがファイアウォールの外側にいる人に私の-ip-アドレスを知らせて私のマシンに接続できるようにするにはどうしたらよいでしょうか>8.18 ファイアウォールの内側にいるのですが、ファイアウォールの外側にいる人に私の IP アドレスを知らせて、私のマシンに接続できるようにするにはどうしたらよいでしょうか？</a></li>
<li><a href=#819-パケットスニファーの書き方を教えてくださいイーサネットインタフェースをプロミスキャスモードにするにはどうしたらよいですか>8.19 パケットスニファーの書き方を教えてください。イーサネットインタフェースをプロミスキャスモードにするにはどうしたらよいですか?</a></li>
<li><a href=#820-tcpudp-ソケットにカスタムタイムアウト値を設定するにはどうすればよいですか>8.20 TCP/UDP ソケットにカスタムタイムアウト値を設定するにはどうすればよいですか？</a></li>
<li><a href=#821-どのポートが使用可能かどうすれば分かりますか公式なポート番号の一覧はありますか>8.21 どのポートが使用可能か、どうすれば分かりますか？&ldquo;公式"なポート番号の一覧はありますか？</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>